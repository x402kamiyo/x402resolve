<!DOCTYPE html>
<html>
<head>
    <title>Create Devnet Wallets</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body {
            font-family: monospace;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0a0a;
            color: #e5e5e5;
        }
        h1 { color: #ff00ff; }
        button {
            background: #ff00ff;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px 5px;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        input {
            padding: 10px;
            font-size: 16px;
            width: 100px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e5e5e5;
            border-radius: 5px;
        }
        #log {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 20px;
            margin-top: 20px;
            height: 500px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .info { color: #00d9ff; }
        .wallet {
            background: #222;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #ff00ff;
        }
        .wallet-key {
            word-break: break-all;
            color: #00d9ff;
        }
    </style>
</head>
<body>
    <h1>Solana Devnet Wallet Creator</h1>

    <div>
        <label>Number of wallets: <input type="number" id="count" value="10" min="1" max="50"></label>
        <label>Airdrop amount (SOL): <input type="number" id="amount" value="1" min="0.1" max="5" step="0.1"></label>
        <label><input type="checkbox" id="skipAirdrop"> Skip airdrop (just create wallets)</label>
    </div>

    <div style="margin-top: 20px;">
        <button onclick="createWallets()" id="createBtn">Create Wallets</button>
        <button onclick="downloadResults()" id="downloadBtn" style="display:none;">Download Results</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div style="margin-top: 20px; padding: 15px; background: #1a1a1a; border: 1px solid #333; border-radius: 5px;">
        <p><strong>Note:</strong> Solana devnet faucet is often rate-limited. If airdrops fail:</p>
        <ul>
            <li>Try creating wallets with "Skip airdrop" checked, then fund them manually at <a href="https://faucet.solana.com" target="_blank" style="color: #00d9ff;">faucet.solana.com</a></li>
            <li>Reduce the airdrop amount to 1 or 0.5 SOL</li>
            <li>Create fewer wallets at a time</li>
        </ul>
    </div>

    <div id="log"></div>

    <script>
        const connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');
        let wallets = [];

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const className = type;
            logDiv.innerHTML += `<div class="${className}">${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            wallets = [];
            document.getElementById('downloadBtn').style.display = 'none';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function requestAirdropWithRetry(publicKey, amount, maxRetries = 5) {
            // Try smaller amounts if large amount fails
            const amounts = amount > 1 ? [amount, 1, 0.5] : [amount];

            for (const tryAmount of amounts) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        log(`  Requesting ${tryAmount} SOL airdrop (attempt ${i + 1}/${maxRetries})...`);
                        const signature = await connection.requestAirdrop(
                            publicKey,
                            tryAmount * solanaWeb3.LAMPORTS_PER_SOL
                        );

                        log(`  Confirming airdrop...`);
                        const confirmation = await connection.confirmTransaction(signature, 'confirmed');

                        if (confirmation.value.err) {
                            throw new Error(`Confirmation failed: ${JSON.stringify(confirmation.value.err)}`);
                        }

                        const balance = await connection.getBalance(publicKey);
                        log(`  Balance: ${balance / solanaWeb3.LAMPORTS_PER_SOL} SOL`, 'success');

                        return signature;
                    } catch (error) {
                        log(`  Airdrop failed: ${error.message}`, 'error');
                        if (i < maxRetries - 1) {
                            const waitTime = (i + 1) * 5; // Increasing wait time
                            log(`  Waiting ${waitTime}s before retry...`);
                            await sleep(waitTime * 1000);
                        } else if (tryAmount !== amounts[amounts.length - 1]) {
                            log(`  Will try smaller amount...`);
                            break; // Try next amount
                        }
                    }
                }
            }

            throw new Error('All airdrop attempts failed');
        }

        async function createWallets() {
            const count = parseInt(document.getElementById('count').value);
            const amount = parseFloat(document.getElementById('amount').value);
            const skipAirdrop = document.getElementById('skipAirdrop').checked;
            const createBtn = document.getElementById('createBtn');

            createBtn.disabled = true;
            wallets = [];

            log(`Creating ${count} wallets on Solana devnet`, 'info');
            if (!skipAirdrop) {
                log(`Airdrop amount: ${amount} SOL per wallet\n`, 'info');
            } else {
                log(`Skipping airdrop - wallets will need manual funding\n`, 'info');
            }

            let successCount = 0;
            let failCount = 0;

            for (let i = 0; i < count; i++) {
                log(`\n[${i + 1}/${count}] Creating wallet...`, 'info');

                // Generate keypair
                const keypair = solanaWeb3.Keypair.generate();
                const publicKey = keypair.publicKey.toString();
                const secretKey = Array.from(keypair.secretKey);

                log(`  Public Key: <span class="wallet-key">${publicKey}</span>`);

                if (!skipAirdrop) {
                    try {
                        await requestAirdropWithRetry(keypair.publicKey, amount);

                        wallets.push({
                            index: i + 1,
                            publicKey: publicKey,
                            secretKey: secretKey,
                            balance: amount,
                            success: true
                        });

                        log(`  ✓ Wallet created and funded`, 'success');
                        successCount++;
                    } catch (error) {
                        wallets.push({
                            index: i + 1,
                            publicKey: publicKey,
                            secretKey: secretKey,
                            balance: 0,
                            success: false,
                            error: error.message
                        });

                        log(`  ✗ Failed to fund wallet: ${error.message}`, 'error');
                        failCount++;
                    }

                    // Delay between wallet creations
                    if (i < count - 1) {
                        log(`\nWaiting 5s before creating next wallet...`);
                        await sleep(5000);
                    }
                } else {
                    // Skip airdrop
                    wallets.push({
                        index: i + 1,
                        publicKey: publicKey,
                        secretKey: secretKey,
                        balance: 0,
                        success: true,
                        needsFunding: true
                    });

                    log(`  ✓ Wallet created (needs manual funding)`, 'success');
                    successCount++;

                    // No delay needed when skipping airdrops
                }
            }

            // Summary
            log('\n' + '='.repeat(60), 'info');
            log('SUMMARY', 'info');
            log('='.repeat(60), 'info');
            log(`\nTotal wallets: ${count}`, 'info');
            log(`Successfully funded: ${successCount}`, 'success');
            log(`Failed: ${failCount}`, 'error');

            if (successCount > 0) {
                log('\n✓ Successfully funded wallets:', 'success');
                wallets.filter(w => w.success).forEach(w => {
                    log(`  ${w.index}. ${w.publicKey} (${w.balance} SOL)`, 'success');
                });
            }

            if (failCount > 0) {
                log('\n✗ Failed wallets:', 'error');
                wallets.filter(w => !w.success).forEach(w => {
                    log(`  ${w.index}. ${w.publicKey} - ${w.error}`, 'error');
                });
            }

            log('\n' + '='.repeat(60), 'info');
            log('DONE - Click "Download Results" to save wallet data', 'info');
            log('='.repeat(60), 'info');

            createBtn.disabled = false;
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        function downloadResults() {
            if (wallets.length === 0) {
                alert('No wallets to download');
                return;
            }

            // Create JSON file with all wallet data
            const data = {
                created: new Date().toISOString(),
                network: 'devnet',
                wallets: wallets
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `solana-wallets-${Date.now()}.json`;
            a.click();

            // Also download addresses only
            const addresses = wallets.map(w => w.publicKey).join('\n');
            const addressBlob = new Blob([addresses], { type: 'text/plain' });
            const addressUrl = URL.createObjectURL(addressBlob);
            const addressLink = document.createElement('a');
            addressLink.href = addressUrl;
            addressLink.download = `solana-addresses-${Date.now()}.txt`;
            addressLink.click();

            log('\n✓ Downloaded wallet data and addresses', 'success');
        }
    </script>
</body>
</html>
