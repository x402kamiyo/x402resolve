<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>x402Resolve - Automated Dispute Resolution Demo | Solana x402 Hackathon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .hackathon-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 15px 0;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quality-score {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .score-bar {
            width: 100%;
            height: 30px;
            background: #e1e8ed;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .timeline {
            margin-top: 20px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .timeline-item.active {
            opacity: 1;
        }

        .timeline-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e1e8ed;
            flex-shrink: 0;
            margin-top: 3px;
        }

        .timeline-item.active .timeline-dot {
            background: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        }

        .timeline-content h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .timeline-content p {
            color: #666;
            font-size: 0.9rem;
        }

        .refund-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
        }

        .refund-amount {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .refund-percentage {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .tech-stack {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .tech-badge {
            background: rgba(255,255,255,0.1);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            color: #1e40af;
        }

        .alert-success {
            background: #dcfce7;
            border-left: 4px solid #10b981;
            color: #065f46;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-verified {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-resolved {
            background: #dcfce7;
            color: #065f46;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>x402Resolve</h1>
            <div class="hackathon-badge">Solana x402 Hackathon 2025</div>
            <p>Automated Dispute Resolution for AI-Generated Data Quality</p>
            <div class="tech-stack">
                <span class="tech-badge">Solana</span>
                <span class="tech-badge">MCP Server</span>
                <span class="tech-badge">x402 Protocol</span>
                <span class="tech-badge">AI Quality Scoring</span>
            </div>
        </div>

        <div class="demo-grid">
            <!-- Left Column: File Dispute Form -->
            <div class="card">
                <h2>
                    <span>ðŸŽ¯</span> File Quality Dispute
                </h2>
                <div class="alert alert-info">
                    <strong>Demo Mode:</strong> Try filing a dispute to see automated quality verification and refund calculation.
                </div>

                <form id="disputeForm">
                    <div class="form-group">
                        <label>Transaction ID</label>
                        <input type="text" id="transactionId" value="tx_kamiyo_abc123" readonly>
                    </div>

                    <div class="form-group">
                        <label>Dispute Reason</label>
                        <select id="disputeReason">
                            <option value="incomplete">Data Incomplete - Missing required fields</option>
                            <option value="no_source">No Source Attribution</option>
                            <option value="wrong_chain">Wrong Blockchain Data</option>
                            <option value="outdated">Outdated Information</option>
                            <option value="inaccurate">Factually Inaccurate</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Expected Quality (0-100)</label>
                        <input type="number" id="expectedQuality" value="80" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label>Additional Evidence</label>
                        <textarea id="evidence" placeholder="Describe what was wrong with the data...">Query for 'Uniswap exploits on Ethereum' returned generic DeFi data without transaction hashes or blockchain verification.</textarea>
                    </div>

                    <button type="submit" id="submitBtn">
                        File Dispute on Solana
                    </button>
                </form>
            </div>

            <!-- Right Column: Dispute Status & Timeline -->
            <div class="card">
                <h2>
                    <span>âš¡</span> Dispute Resolution
                </h2>

                <div id="statusDisplay">
                    <p style="color: #666; text-align: center; padding: 40px;">
                        File a dispute to see automated quality verification
                    </p>
                </div>

                <div id="timelineDisplay" style="display: none;">
                    <div class="timeline">
                        <div class="timeline-item" id="step1">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Dispute Filed</h4>
                                <p>Transaction submitted to Solana escrow</p>
                            </div>
                        </div>
                        <div class="timeline-item" id="step2">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>x402 Verifier Analysis</h4>
                                <p>AI quality scoring in progress...</p>
                            </div>
                        </div>
                        <div class="timeline-item" id="step3">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Quality Verified</h4>
                                <p>Score calculated, refund determined</p>
                            </div>
                        </div>
                        <div class="timeline-item" id="step4">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Refund Processed</h4>
                                <p>Funds returned via Solana smart contract</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="resultsDisplay" style="display: none;"></div>
            </div>
        </div>

        <!-- Trust Model -->
        <div class="card">
            <h2>
                <span>ðŸ”’</span> Trust Model for Autonomous Agents
            </h2>
            <div class="alert alert-success">
                <strong>16 out of 16</strong> trust features implemented (100% complete)
            </div>

            <div style="display: grid; gap: 20px; margin-top: 20px;">
                <div style="border-left: 4px solid #667eea; padding-left: 15px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">1. How Do We Trust Them? (6/6)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">âœ“ On-chain audit trail (immutable)</li>
                        <li style="padding: 5px 0;">âœ“ Ed25519 cryptographic signatures</li>
                        <li style="padding: 5px 0;">âœ“ Objective quality scoring algorithm</li>
                        <li style="padding: 5px 0;">âœ“ Agent reputation system (0-1000 score)</li>
                        <li style="padding: 5px 0;">âœ“ Historical performance tracking</li>
                        <li style="padding: 5px 0;">âœ“ Verification badges (Basic/Staked/Social/KYC)</li>
                    </ul>
                </div>

                <div style="border-left: 4px solid #10b981; padding-left: 15px;">
                    <h4 style="color: #10b981; margin-bottom: 10px;">2. What's the Scope of Work? (4/4)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">âœ“ Query-based specification</li>
                        <li style="padding: 5px 0;">âœ“ Validation criteria (fields, records, age)</li>
                        <li style="padding: 5px 0;">âœ“ Structured work agreements</li>
                        <li style="padding: 5px 0;">âœ“ Pre-flight validation</li>
                    </ul>
                </div>

                <div style="border-left: 4px solid #f59e0b; padding-left: 15px;">
                    <h4 style="color: #f59e0b; margin-bottom: 10px;">3. What Happens When They Mess Up? (4/4)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">âœ“ Automated dispute resolution (24-48h)</li>
                        <li style="padding: 5px 0;">âœ“ Sliding scale refunds (0-100%)</li>
                        <li style="padding: 5px 0;">âœ“ Multi-tier dispute escalation</li>
                        <li style="padding: 5px 0;">âœ“ Provider penalty system (strikes)</li>
                    </ul>
                </div>

                <div style="border-left: 4px solid #8b5cf6; padding-left: 15px;">
                    <h4 style="color: #8b5cf6; margin-bottom: 10px;">4. Who Gives Reputation/Refunds? (2/2)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">âœ“ Automated verifier oracle</li>
                        <li style="padding: 5px 0;">âœ“ On-chain smart contract execution</li>
                    </ul>
                </div>

                <div style="border-left: 4px solid #ef4444; padding-left: 15px;">
                    <h4 style="color: #ef4444; margin-bottom: 10px;">5. How Do We Stop Exploitation? (6/6)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0;">âœ“ Time-lock protection (max 7 days)</li>
                        <li style="padding: 5px 0;">âœ“ PDA-based security</li>
                        <li style="padding: 5px 0;">âœ“ Clear dispute window (48 hours)</li>
                        <li style="padding: 5px 0;">âœ“ Rate limiting per entity</li>
                        <li style="padding: 5px 0;">âœ“ Dispute cost scaling (1x-10x)</li>
                        <li style="padding: 5px 0;">âœ“ Sybil attack protection</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 8px;">
                <p style="font-size: 0.9rem; color: #666;">
                    See <a href="../TRUST_MODEL.md" style="color: #667eea;">TRUST_MODEL.md</a> for complete architecture
                </p>
            </div>
        </div>

        <!-- Quality Scoring Explanation -->
        <div class="card">
            <h2>
                <span>ðŸ”¬</span> How x402Resolve Works
            </h2>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">Semantic Coherence</div>
                    <div class="metric-value">40%</div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Does data match the query intent?
                    </p>
                </div>
                <div class="metric">
                    <div class="metric-label">Completeness</div>
                    <div class="metric-value">40%</div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        All required fields present?
                    </p>
                </div>
                <div class="metric">
                    <div class="metric-label">Freshness</div>
                    <div class="metric-value">20%</div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Is the data recent?
                    </p>
                </div>
            </div>

            <div class="quality-score">
                <h3 style="margin-bottom: 15px;">Refund Calculation (Sliding Scale)</h3>
                <ul style="list-style: none;">
                    <li style="padding: 8px 0;">ðŸ“Š <strong>90-100:</strong> No refund (high quality)</li>
                    <li style="padding: 8px 0;">ðŸ“Š <strong>70-89:</strong> 25% refund</li>
                    <li style="padding: 8px 0;">ðŸ“Š <strong>50-69:</strong> 50% refund</li>
                    <li style="padding: 8px 0;">ðŸ“Š <strong>30-49:</strong> 75% refund</li>
                    <li style="padding: 8px 0;">ðŸ“Š <strong>0-29:</strong> 100% refund (very poor quality)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('disputeForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusDisplay = document.getElementById('statusDisplay');
        const timelineDisplay = document.getElementById('timelineDisplay');
        const resultsDisplay = document.getElementById('resultsDisplay');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Filing Dispute...';

            // Show timeline
            statusDisplay.style.display = 'none';
            timelineDisplay.style.display = 'block';
            resultsDisplay.style.display = 'none';

            // Simulate dispute filing process
            await simulateDisputeProcess();
        });

        async function simulateDisputeProcess() {
            const reason = document.getElementById('disputeReason').value;
            const expectedQuality = parseInt(document.getElementById('expectedQuality').value);

            // Step 1: Dispute Filed (immediate)
            activateTimelineStep('step1');
            await sleep(1000);

            // Step 2: Verifier Analysis (2 seconds)
            activateTimelineStep('step2');
            submitBtn.textContent = 'x402 Verifier Analyzing...';
            await sleep(2000);

            // Calculate simulated quality score based on dispute reason
            const qualityScores = {
                'incomplete': { semantic: 0.6, completeness: 0.3, freshness: 0.4 },
                'no_source': { semantic: 0.7, completeness: 0.2, freshness: 0.5 },
                'wrong_chain': { semantic: 0.3, completeness: 0.5, freshness: 0.6 },
                'outdated': { semantic: 0.7, completeness: 0.8, freshness: 0.1 },
                'inaccurate': { semantic: 0.2, completeness: 0.6, freshness: 0.5 }
            };

            const scores = qualityScores[reason] || qualityScores['incomplete'];
            const overallScore = Math.round(
                scores.semantic * 0.4 +
                scores.completeness * 0.4 +
                scores.freshness * 0.2
            ) * 100;

            // Calculate refund percentage
            let refundPercent = 0;
            if (overallScore < 30) refundPercent = 100;
            else if (overallScore < 50) refundPercent = 75;
            else if (overallScore < 70) refundPercent = 50;
            else if (overallScore < 90) refundPercent = 25;

            const refundAmount = (10 * refundPercent / 100).toFixed(2);

            // Step 3: Quality Verified
            activateTimelineStep('step3');
            submitBtn.textContent = 'Calculating Refund...';
            await sleep(1500);

            // Step 4: Refund Processed
            activateTimelineStep('step4');
            await sleep(1000);

            // Show results
            showResults(overallScore, scores, refundPercent, refundAmount);
        }

        function activateTimelineStep(stepId) {
            document.getElementById(stepId).classList.add('active');
        }

        function showResults(overallScore, scores, refundPercent, refundAmount) {
            resultsDisplay.style.display = 'block';

            resultsDisplay.innerHTML = `
                <div class="alert alert-success">
                    <strong>âœ… Dispute Resolved!</strong> Quality verification complete.
                </div>

                <div class="quality-score">
                    <h3>Quality Assessment</h3>
                    <div class="score-bar">
                        <div class="score-fill" style="width: ${overallScore}%">
                            ${overallScore}/100
                        </div>
                    </div>

                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">Semantic</div>
                            <div class="metric-value">${Math.round(scores.semantic * 100)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Complete</div>
                            <div class="metric-value">${Math.round(scores.completeness * 100)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Fresh</div>
                            <div class="metric-value">${Math.round(scores.freshness * 100)}%</div>
                        </div>
                    </div>
                </div>

                ${refundPercent > 0 ? `
                    <div class="refund-card">
                        <div>ðŸ’° Refund Processed</div>
                        <div class="refund-amount">$${refundAmount}</div>
                        <div class="refund-percentage">${refundPercent}% of $10.00 payment</div>
                        <p style="margin-top: 15px; opacity: 0.9; font-size: 0.9rem;">
                            Solana TX: 7LPz...4kQ9
                        </p>
                    </div>
                ` : `
                    <div style="text-align: center; padding: 20px; background: #f3f4f6; border-radius: 8px; margin-top: 20px;">
                        <h3 style="color: #10b981; margin-bottom: 10px;">âœ… No Refund Needed</h3>
                        <p style="color: #666;">Data quality meets standards (score â‰¥ 90)</p>
                    </div>
                `}

                <button onclick="resetDemo()" style="margin-top: 20px; background: #6b7280;">
                    Try Another Dispute
                </button>
            `;

            submitBtn.textContent = 'Dispute Resolved';
        }

        function resetDemo() {
            // Reset timeline
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.classList.remove('active');
            });

            // Reset displays
            statusDisplay.style.display = 'block';
            timelineDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';

            // Reset button
            submitBtn.disabled = false;
            submitBtn.textContent = 'File Dispute on Solana';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
