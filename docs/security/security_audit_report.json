{
  "total_findings": 49,
  "critical": 0,
  "high": 1,
  "medium": 43,
  "low": 5,
  "status": "PASSED WITH WARNINGS - Address high/medium issues",
  "findings": [
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 192,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "let min_rent = rent.minimum_balance(8 + Escrow::INIT_SPACE);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 209,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Escrow initialized: {} SOL locked\", amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "high",
      "category": "Missing Authorization",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 230,
      "description": "Function may be missing signer validation",
      "code_snippet": "pub fn release_funds(ctx: Context<ReleaseFunds>) -> Result<()> {",
      "recommendation": "Add #[account(signer)] constraint"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 256,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let seeds = &[",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 261,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let signer = &[&seeds[..]];",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 276,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Funds released to API: {} SOL\", escrow.amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 339,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "let payment_amount = escrow.amount - refund_amount;",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 341,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Refund to Agent: {} SOL\", refund_amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 342,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Payment to API: {} SOL\", payment_amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 350,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let seeds = &[",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 355,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let signer = &[&seeds[..]];",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 370,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let seeds = &[",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 375,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let signer = &[&seeds[..]];",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 424,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "let quality_delivered = 100 - refund_percentage;",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 523,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "let payment_amount = escrow.amount - refund_amount;",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 525,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Refund to Agent: {} SOL\", refund_amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 526,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "msg!(\"Payment to API: {} SOL\", payment_amount as f64 / 1_000_000_000.0);",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 534,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let seeds = &[",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 539,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let signer = &[&seeds[..]];",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 554,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let seeds = &[",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 559,
      "description": "PDA seeds without bump validation",
      "code_snippet": "let signer = &[&seeds[..]];",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 604,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "let quality_delivered = 100 - refund_percentage;",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 844,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"escrow\", transaction_id.as_bytes()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 862,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"escrow\", escrow.transaction_id.as_bytes()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 881,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"escrow\", escrow.transaction_id.as_bytes()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 902,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", agent.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 909,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", api.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 921,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"escrow\", escrow.transaction_id.as_bytes()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 939,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", agent.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 946,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", api.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 958,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"escrow\", escrow.transaction_id.as_bytes()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 965,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", agent.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 980,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", entity.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 998,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"reputation\", reputation.entity.as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "PDA Validation",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1011,
      "description": "PDA seeds without bump validation",
      "code_snippet": "seeds = [b\"rate_limit\", entity.key().as_ref()],",
      "recommendation": "Include bump parameter in PDA derivation"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1028,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "pub amount: u64,                      // 8",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1036,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "pub refund_percentage: Option<u8>,    // 1 + 1",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1044,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "Resolved,    // Dispute resolved with refund split",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1116,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "pub total_refunds_issued: u64,        // 8",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "medium",
      "category": "Integer Overflow",
      "file": "packages/x402-escrow/programs/x402-escrow/src/lib.rs",
      "line": 1138,
      "description": "Potential integer overflow in arithmetic operation",
      "code_snippet": "#[msg(\"Invalid refund percentage (must be 0-100)\")]",
      "recommendation": "Use checked_add(), checked_sub(), or checked_mul()"
    },
    {
      "severity": "low",
      "category": "Input Validation",
      "file": "packages/x402-sdk/src/switchboard-client.ts",
      "line": 205,
      "description": "PublicKey constructor without try-catch",
      "code_snippet": "const DEVNET_QUEUE = new PublicKey('FfD96yeXs4cxZshoPPSKhSPgVQxLAJUT3gefgh84m1Di');",
      "recommendation": "Wrap PublicKey constructor in try-catch"
    },
    {
      "severity": "low",
      "category": "Input Validation",
      "file": "packages/x402-sdk/src/switchboard-client.ts",
      "line": 219,
      "description": "PublicKey constructor without try-catch",
      "code_snippet": "const MAINNET_QUEUE = new PublicKey('A43DyUGA7s8eXPxqEjJY6EBu1KKbNgfxF8h17VAHn13w');",
      "recommendation": "Wrap PublicKey constructor in try-catch"
    },
    {
      "severity": "low",
      "category": "Input Validation",
      "file": "packages/x402-sdk/src/switchboard-client.ts",
      "line": 276,
      "description": "PublicKey constructor without try-catch",
      "code_snippet": "new PublicKey('SW1TCHxQUEF4eoNDx91g63WPR6AQdUxCKmLkEFiyjY1')",
      "recommendation": "Wrap PublicKey constructor in try-catch"
    },
    {
      "severity": "low",
      "category": "Input Validation",
      "file": "packages/x402-sdk/src/client.ts",
      "line": 53,
      "description": "PublicKey constructor without try-catch",
      "code_snippet": "? new PublicKey(config.walletPublicKey)",
      "recommendation": "Wrap PublicKey constructor in try-catch"
    },
    {
      "severity": "medium",
      "category": "Error Handling",
      "file": "packages/agent-client/src/index.ts",
      "line": 51,
      "description": "Fetch call without error handling",
      "code_snippet": "const initialResponse = await fetch(endpoint, {",
      "recommendation": "Add try-catch or .catch() handler"
    },
    {
      "severity": "medium",
      "category": "Error Handling",
      "file": "packages/agent-client/src/index.ts",
      "line": 77,
      "description": "Fetch call without error handling",
      "code_snippet": "const response = await fetch(endpoint, {",
      "recommendation": "Add try-catch or .catch() handler"
    },
    {
      "severity": "medium",
      "category": "Error Handling",
      "file": "packages/agent-client/src/index.ts",
      "line": 222,
      "description": "Fetch call without error handling",
      "code_snippet": "const response = await fetch(disputeEndpoint, {",
      "recommendation": "Add try-catch or .catch() handler"
    },
    {
      "severity": "medium",
      "category": "Error Handling",
      "file": "packages/agent-client/src/cdp-agent.ts",
      "line": 77,
      "description": "Fetch call without error handling",
      "code_snippet": "const response = await fetch(endpoint);",
      "recommendation": "Add try-catch or .catch() handler"
    },
    {
      "severity": "low",
      "category": "Logic Error",
      "file": "packages/agent-client/src/cdp-agent.ts",
      "line": 109,
      "description": "Quality threshold comparison without bounds check",
      "code_snippet": ".filter(tool => tool.expectedQuality >= this.config.qualityThreshold)",
      "recommendation": "Ensure threshold is between 0-100"
    }
  ]
}